!function(t){function i(i,s){this.b=t(i),this.a=t.extend({},e,s),this.M()}var e={containerHTML:'<div class="multi-select-container">',menuHTML:'<div class="multi-select-menu">',buttonHTML:'<span class="multi-select-button">',menuItemsHTML:'<div class="multi-select-menuitems">',menuItemHTML:'<label class="multi-select-menuitem">',presetsHTML:'<div class="multi-select-presets">',modalHTML:void 0,menuItemTitleClass:"multi-select-menuitem--titled",activeClass:"multi-select-container--open",noneText:"-- Select --",allText:void 0,presets:void 0,positionedMenuClass:"multi-select-container--positioned",positionMenuWithin:void 0,viewportBottomGutter:20,menuMinHeight:200};t.extend(i.prototype,{M:function(){this.C(),this.L(),this.F(),this.D(),this.G(),this.J(),this.N(),this.O(),this.b.hide()},C:function(){if(!1===this.b.is("select[multiple]"))throw Error("$.multiSelect only works on <select multiple> elements")},L:function(){this.l=t('label[for="'+this.b.attr("id")+'"]')},F:function(){this.f=t(this.a.containerHTML),this.b.data("multi-select-container",this.f),this.f.insertAfter(this.b)},D:function(){var i=this;this.g=t(this.a.buttonHTML),this.g.attr({role:"button","aria-haspopup":"true",tabindex:0,"aria-label":this.l.eq(0).text()}).on("keydown.multiselect",(function(t){var e=t.which;13===e||32===e?(t.preventDefault(),i.g.click()):40===e?(t.preventDefault(),i.s(),(i.i||i.h).children().first().focus()):27===e&&i.j()})).on("click.multiselect",(function(){i.u()})).appendTo(this.f),this.b.on("change.multiselect",(function(){i.w()})),this.w()},w:function(){var i=[],e=[];this.b.find("option").each((function(){var s=t(this).text();i.push(s),t(this).is(":selected")&&e.push(t.trim(s))})),this.g.empty(),0==e.length?this.g.text(this.a.noneText):e.length===i.length&&this.a.allText?this.g.text(this.a.allText):this.g.text(e.join(", "))},G:function(){var i=this;this.c=t(this.a.menuHTML),this.c.attr({role:"menu"}).on("keyup.multiselect",(function(t){27===t.which&&(i.j(),i.g.focus())})).appendTo(this.f),this.H(),this.a.presets&&this.K()},H:function(){var i=this;this.h=t(this.a.menuItemsHTML),this.c.append(this.h),this.b.on("change.multiselect",(function(t,e){!0!==e&&i.A()})),this.A()},A:function(){var i=this;this.h.empty(),this.b.children("optgroup,option").each((function(e,s){"OPTION"===s.nodeName?(e=i.o(t(s),e),i.h.append(e)):i.I(t(s),e)}))},v:function(i,e){var s=e.which;38===s?(e.preventDefault(),(e=t(e.currentTarget).prev()).length?e.focus():this.i&&"menuitem"===i?this.i.children().last().focus():this.g.focus()):40===s&&(e.preventDefault(),(e=t(e.currentTarget).next()).length||"menuitem"===i?e.focus():this.h.children().first().focus())},K:function(){var i=this;this.i=t(this.a.presetsHTML),this.c.prepend(this.i),t.each(this.a.presets,(function(e,s){e=i.b.attr("name")+"_preset_"+e;var n=t(i.a.menuItemHTML).attr({for:e,role:"menuitem"}).text(" "+s.name).on("keydown.multiselect",i.v.bind(i,"preset")).appendTo(i.i);e=t("<input>").attr({type:"radio",name:i.b.attr("name")+"_presets",id:e}).prependTo(n),s.all&&(s.options=[],i.b.find("option").each((function(){var i=t(this).val();s.options.push(i)}))),e.on("change.multiselect",(function(){i.b.val(s.options),i.b.trigger("change")}))})),this.b.on("change.multiselect",(function(){i.B()})),this.B()},B:function(){var i=this;t.each(this.a.presets,(function(t,e){t=i.b.attr("name")+"_preset_"+t,t=i.i.find("#"+t);t:{e=e.options||[];var s=i.b.val()||[];if(e.length!=s.length)e=!1;else{e.sort(),s.sort();for(var n=0;n<e.length;n++)if(e[n]!==s[n]){e=!1;break t}e=!0}}e?t.prop("checked",!0):t.prop("checked",!1)}))},I:function(i,e){var s=this;i.children("option").each((function(n,o){o=s.o(t(o),e+"_"+n);var h=s.a.menuItemTitleClass;0!==n&&(h+="sr"),o.addClass(h).attr("data-group-title",i.attr("label")),s.h.append(o)}))},o:function(i,e){var s=this.b.attr("name")+"_"+e;return e=t(this.a.menuItemHTML).attr({for:s,role:"menuitem"}).on("keydown.multiselect",this.v.bind(this,"menuitem")).text(" "+i.text()),s=t("<input>").attr({type:"checkbox",id:s,value:i.val()}).prependTo(e),i.is(":disabled")&&s.attr("disabled","disabled"),i.is(":selected")&&s.prop("checked","checked"),s.on("change.multiselect",(function(){t(this).prop("checked")?i.prop("selected",!0):i.prop("selected",!1),i.trigger("change",[!0])})),e},J:function(){var i=this;this.a.modalHTML&&(this.m=t(this.a.modalHTML),this.m.on("click.multiselect",(function(){i.j()})),this.m.insertBefore(this.c))},N:function(){var i=this;t("html").on("click.multiselect",(function(){i.j()})),this.f.on("click.multiselect",(function(t){t.stopPropagation()}))},O:function(){var t=this;this.l.on("click.multiselect",(function(i){i.preventDefault(),i.stopPropagation(),t.u()}))},s:function(){if(t("html").trigger("click.multiselect"),this.f.addClass(this.a.activeClass),this.a.positionMenuWithin&&this.a.positionMenuWithin instanceof t){var i=this.c.offset().left+this.c.outerWidth(),e=this.a.positionMenuWithin.offset().left+this.a.positionMenuWithin.outerWidth();i>e&&(this.c.css("width",e-this.c.offset().left),this.f.addClass(this.a.positionedMenuClass))}(i=this.c.offset().top+this.c.outerHeight())>(e=t(window).scrollTop()+t(window).height())-this.a.viewportBottomGutter?this.c.css({maxHeight:Math.max(e-this.a.viewportBottomGutter-this.c.offset().top,this.a.menuMinHeight),overflow:"scroll"}):this.c.css({maxHeight:"",overflow:""})},j:function(){this.f.removeClass(this.a.activeClass),this.f.removeClass(this.a.positionedMenuClass),this.c.css("width","auto")},u:function(){this.f.hasClass(this.a.activeClass)?this.j():this.s()}}),t.fn.multiSelect=function(e){return this.each((function(){t.data(this,"plugin_multiSelect")||t.data(this,"plugin_multiSelect",new i(this,e))}))}}(jQuery);